---
import CategoryMenuItem from "./CategoryMenuItem.astro";
import { slugify } from "../lib/slugify";

interface Subcategory {
  name: string;
  count: number;
  url: string;
}

export interface Props {
  cookbookName: string;
  cookbookUrl: string;
  cookbookCount: number;
  subcategories: Subcategory[];
  isActive?: boolean;
  activeSubcategory?: string;
}

const {
  cookbookName,
  cookbookUrl,
  cookbookCount,
  subcategories,
  isActive = false,
  activeSubcategory,
} = Astro.props;

// Generate unique ID for this category group using slug
const groupId = `category-group-${slugify(cookbookName)}`;
---

<div class="collapsible-category-group" data-group-id={groupId}>
  <div class="main-category-header">
    <a
      href={cookbookUrl}
      class={`main-category-link ${isActive ? 'active' : ''}`}
    >
      <span class="item-name">{cookbookName}</span>
      <span class="item-count">{cookbookCount}</span>
    </a>
    <button
      class="collapse-toggle"
      data-group-id={groupId}
      aria-label={`Toggle ${cookbookName} subcategories`}
      aria-expanded="false"
    >
      <span class="chevron">â–¶</span>
    </button>
  </div>

  <div class="subcategories-container" data-group-id={groupId}>
    {
      subcategories.map((subcat) => (
        <CategoryMenuItem
          href={subcat.url}
          name={subcat.name}
          count={subcat.count}
          isActive={activeSubcategory === subcat.name}
          isSubcategory={true}
        />
      ))
    }
  </div>
</div>

<style>
  .collapsible-category-group {
    border-bottom: 1px solid rgba(211, 84, 0, 0.08);
  }

  .main-category-header {
    display: flex;
    align-items: stretch;
  }

  .main-category-link {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.75rem 0.75rem 0.75rem 1.25rem;
    color: #2c2c2c;
    text-decoration: none;
    font-size: 0.9rem;
    font-weight: 600;
    background: rgba(211, 84, 0, 0.03);
    border-left: 3px solid rgba(211, 84, 0, 0.3);
    transition: all 0.2s ease;
  }

  .main-category-link:hover {
    background: rgba(211, 84, 0, 0.08);
    color: #d35400;
  }

  .main-category-link.active {
    background: rgba(211, 84, 0, 0.1);
    color: #d35400;
    font-weight: 700;
  }

  .item-name {
    text-transform: capitalize;
  }

  .item-count {
    background: rgba(211, 84, 0, 0.15);
    color: #d35400;
    padding: 0.2rem 0.5rem;
    border-radius: 1rem;
    font-size: 0.75rem;
    font-weight: 700;
  }

  .main-category-link.active .item-count {
    background: #d35400;
    color: white;
  }

  .collapse-toggle {
    width: 2.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(211, 84, 0, 0.03);
    border: none;
    border-left: 1px solid rgba(211, 84, 0, 0.12);
    cursor: pointer;
    transition: all 0.2s ease;
    color: #999;
  }

  .collapse-toggle:hover {
    background: rgba(211, 84, 0, 0.1);
    color: #d35400;
  }

  .chevron {
    font-size: 0.7rem;
    transition: transform 0.3s ease;
    display: inline-block;
  }

  .collapse-toggle[aria-expanded="true"] .chevron {
    transform: rotate(90deg);
  }

  .subcategories-container {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease;
  }

  .subcategories-container.expanded {
    max-height: 500px; /* Large enough for any reasonable number of subcategories */
  }
</style>
